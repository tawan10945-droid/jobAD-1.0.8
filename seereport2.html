<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏≤‡∏ò‡∏¥‡∏ï</title>
<style>
body {
  font-family: "TH SarabunPSK", sans-serif;
  font-size: 14px;
  margin: 40px;
  color: #000;
}
h3 {
  text-align: center;
  margin-bottom: 0;
}
p.right {
  text-align: right;
  margin-top: 5px;
}
table {
  border-collapse: collapse;
  width: 100%;
  margin-bottom: 15px;
}
th, td {
  border: 1px solid #000;
  padding: 5px 6px;
  vertical-align: top;
}
th {
  text-align: center;
  background: #f5f5f5;
}
input[type="text"], input[type="date"] {
  width: 100%;
  border: none;
  border-bottom: 1px dotted #000;
  font-size: 14px;
  font-family: "TH SarabunPSK", sans-serif;
  outline: none;
  background: transparent;
}
input[type="date"] {
  padding: 2px 4px;
  border: none;
  border-bottom: 1px dotted #000;
  background: transparent;
  position: relative;
  color: transparent;
}
/* ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û.‡∏®. ‡∏ö‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞ */
input[type="date"]::before {
  content: attr(data-thai-date);
  position: absolute;
  left: 0;
  color: #000;
  pointer-events: none;
}
input[type="date"]::-webkit-datetime-edit {
  color: transparent;
}
input[type="date"]::-webkit-calendar-picker-indicator {
  position: absolute;
  right: 0;
  opacity: 0.5;
  cursor: pointer;
}
input[type="checkbox"] {
  transform: scale(1.2);
  margin-right: 4px;
}
button, .btnH {
  display: block;
  margin: 20px auto;
  font-size: 14px;
  padding: 6px 12px;
  background: #c00;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
button:hover, .btnH:hover { background: #900; }
.status { text-align: center; font-weight: bold; margin-top: 10px; color: green; }
</style>
<div>
  <a href="notchoose.html" class="btnH" id="backBtn">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</a>
</div>
</head>
<body>
<p class="right">
  ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô<br>
  ‡∏ù‡πà‡∏≤‡∏¢‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°
</p>

<h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏≤‡∏ò‡∏¥‡∏ï</h3><br><br>

<div style="margin-bottom:20px;">
  <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏á‡∏≤‡∏ô (Job Number): </label>
  <input type="text" id="jobNumberInput" readonly>
</div>

<table>
  <tr><th>‡πÅ‡∏ú‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡πÄ‡∏ß‡∏•‡∏≤</th></tr>
  <tr><td>‡∏≠‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏≤‡∏Å Office</td><td><input type="text" id="startDateInput" readonly></td><td><input type="text" id="time1"></td></tr>
  <tr><td>‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∏‡∏î‡∏ù‡∏∂‡∏Å</td><td><input type="date" id="date2"></td><td><input type="text" id="time2"></td></tr>
  <tr><td>‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö‡∏ä‡∏∏‡∏î‡∏ù‡∏∂‡∏Å</td><td><input type="date" id="date3"></td><td><input type="text" id="time3"></td></tr>
  <tr><td>‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏•‡∏±‡∏ö Office</td><td><input type="text" id="endDateInput" readonly></td><td><input type="text" id="time4"></td></tr>
</table>

<table>
  <tr>
    <td>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</td>
    <td><label><input type="checkbox" id="car_company"> ‡∏£‡∏ñ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</label></td>
    <td><label><input type="checkbox" id="car_sales"> ‡∏£‡∏ñ Sales</label></td>
    <td><label><input type="checkbox" id="bus"> ‡∏£‡∏ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ó‡∏≤‡∏á</label></td>
    <td><label><input type="checkbox" id="plane"> ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏¥‡∏ô</label></td>
  </tr>
  <tr>
    <td>Sales ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà:</td>
    <td><label><input type="checkbox" id="sales_no"> ‡πÑ‡∏°‡πà‡πÑ‡∏õ</label></td>
    <td><label><input type="checkbox" id="sales_yes"> ‡πÑ‡∏õ</label></td>
    <td><label><input type="checkbox" id="sales_together"> ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô</label></td>
    <td><label><input type="checkbox" id="sales_separate"> ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô‡πÑ‡∏õ</label></td>
  </tr>
</table>

<table>
  <tr><td>‡∏°‡∏µ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏≠‡∏∑‡πà‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏à‡∏±‡∏î‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà:</td>
    <td><label><input type="checkbox" id="company_have"> ‡∏°‡∏µ</label></td>
    <td><label><input type="checkbox" id="company_not_have"> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label></td></tr>
  <tr><td>‡∏°‡∏µ‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà:</td>
    <td><label><input type="checkbox" id="schedule_have"> ‡∏°‡∏µ(‡πÅ‡∏ô‡∏ö)</label></td>
    <td><label><input type="checkbox" id="schedule_not_have"> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label></td></tr>
  <tr><td>‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏Ç‡∏ô‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà:</td>
    <td><label><input type="checkbox" id="map_have"> ‡∏°‡∏µ(‡πÅ‡∏ô‡∏ö)</label></td>
    <td><label><input type="checkbox" id="map_not_have"> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label></td></tr>
  <tr><td>‡∏°‡∏µ‡∏õ‡∏•‡∏±‡πä‡∏Å‡πÑ‡∏ü‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà:</td>
    <td><label><input type="checkbox" id="plug_have"> ‡∏°‡∏µ</label></td>
    <td><label><input type="checkbox" id="plug_not_have"> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label></td></tr>
  <tr><td>‡∏°‡∏µ‡∏õ‡∏±‡πä‡∏°‡∏•‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∏‡∏î‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏°‡πÉ‡∏´‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà:</td>
    <td><label><input type="checkbox" id="air_have"> ‡∏°‡∏µ</label></td>
    <td><label><input type="checkbox" id="air_not_have"> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label></td></tr>
</table>

<table>
  <th colspan="4">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡πÑ‡∏õ‡∏à‡∏±‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏≤‡∏ò‡∏¥‡∏ï</th>
  <tr>
    <td><label><input type="checkbox" id="MPUA"> MPU-A</label></td>
    <td><label><input type="checkbox" id="MPUB"> MPU-B</label></td>
    <td><label><input type="checkbox" id="MPUC"> MPU-C</label></td>
    <td><label><input type="checkbox" id="MPUD"> MPU-D</label></td>
  </tr>
</table>

<table>
  <th>- ‡∏ä‡∏∏‡∏î‡πÅ‡∏°‡∏Ñ‡∏Ñ‡∏≤‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå</th>
  <td><label><input type="checkbox" id="MC_01"> MC-01</label></td>
  <td><label><input type="checkbox" id="MC_02"> MC-02</label></td>
  <td><label><input type="checkbox" id="MC_03"> MC-03</label></td>
</table>

<table>
  <tr><th>PLC ‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</th><td><input type="text" id="PLC1"></td><th>‡∏£‡∏∏‡πà‡∏ô</th><td><input type="text" id="ver"></td></tr>
  <tr><th>‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</th><td><input  type="text" id="BOT"></td><th>‡∏£‡∏∏‡πà‡∏ô</th><td><input type="text" id="ver2"></td></tr>
  <tr><th>‡πÇ‡∏ï‡πä‡∏∞‡∏ß‡∏≤‡∏á‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå ‡∏Ç‡∏ô‡∏≤‡∏î</th><td colspan="3"><input type="text" id="tableSize"></td></tr>
  <tr><th>‡∏ä‡∏∏‡∏î‡∏ù‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà</th></tr>
  <tr><td colspan="4"><input type="text"  id="otherEquip"></td></tr>
</table>

<table>
  <tr><th colspan="3">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏¢‡πâ‡∏≤‡∏¢</th></tr>
  <tr>
    <td><label><input type="checkbox" id="move_all_top"> ‡∏à‡πâ‡∏≤‡∏á‡∏¢‡πâ‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</label></td>
    <td><label><input type="checkbox" id="move_all_bottom"> ‡∏Ç‡∏ô‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</label></td>
    <td><label><input type="checkbox" id="move_partial"> ‡∏à‡πâ‡∏≤‡∏á‡∏Ç‡∏ô‡∏¢‡πâ‡∏≤‡∏¢‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô</label></td>
  </tr>
</table>

<table>
  <tr><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th></tr>
  <tr><td><input type="text" id="carry1"></td><td><input  type="text"  id="carryQty1"></td></tr>
  <tr><td><input type="text" id="carry2"></td><td><input   type="text" id="carryQty2"></td></tr>
  <tr><td><input type="text" id="carry3"></td><td><input  type="text" id="carryQty3"></td></tr>
</table>

<table>
  <tr><th>‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∏‡∏î‡∏ù‡∏∂‡∏Å‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏∂‡∏Å‡πÑ‡∏´‡∏ô (‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà)...</th></tr>
  <tr><td><input type="text" id="roomInfo"></td></tr>
</table>

<button onclick="saveFile()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
<div id="statusMsg" class="status"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyABY8jkjB2RD3RPK-qQ6kJThm32Pc9OpKE",
  authDomain: "events-93cb9.firebaseapp.com",
  databaseURL: "https://events-93cb9-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "events-93cb9",
  storageBucket: "events-93cb9.firebasestorage.app",
  messagingSenderId: "234410411694",
  appId: "1:234410411694:web:b544058bce0dfe78a88f3f",
  measurementId: "G-4D3X216R1K"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö position ‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö
function setupBackButton() {
  const backBtn = document.getElementById("backBtn");
  
  // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ position ‡∏à‡∏≤‡∏Å URL parameter, sessionStorage ‡∏´‡∏£‡∏∑‡∏≠ localStorage
  const urlParams = new URLSearchParams(window.location.search);
  let userPosition = urlParams.get('position') || 
                     sessionStorage.getItem("userPosition") || 
                     localStorage.getItem("userPosition");
  
  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å position ‡∏à‡∏≤‡∏Å URL ‡∏•‡∏á storage (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
  if (urlParams.get('position')) {
    sessionStorage.setItem("userPosition", urlParams.get('position'));
    localStorage.setItem("userPosition", urlParams.get('position'));
  }
  
  console.log("üîç User Position:", userPosition);
  
  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ï‡∏≤‡∏° position
  if (userPosition && userPosition.toLowerCase() === "engineer") {
    backBtn.href = 'home.html';
    console.log("‚û°Ô∏è ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤: home.html (Engineer)");
  } else {
    backBtn.href = 'notchoose.html';
    console.log("‚û°Ô∏è ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤: notchoose.html (Sales/Other)");
  }
}

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
setupBackButton();
// ‚úÖ ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å query string
const params = new URLSearchParams(window.location.search);
const jobNumber = params.get("job") || "";
const start = params.get("start") || "";
const end = params.get("end") || "";

// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô DD/MM/YYYY (‡∏û.‡∏®.)
function formatDateThai(dateStr) {
  if (!dateStr) return "";
  const date = new Date(dateStr);
  const day = date.getDate();
  const month = date.getMonth() + 1;
  const year = date.getFullYear() + 543;
  return `${day}/${month}/${year}`;
}

// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏≤‡∏Å ISO date (YYYY-MM-DD) ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏ó‡∏¢
function isoToThai(isoDate) {
  if (!isoDate) return "";
  const [year, month, day] = isoDate.split("-");
  return `${parseInt(day)}/${parseInt(month)}/${parseInt(year) + 543}`;
}

// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏ó‡∏¢ (DD/MM/YYYY ‡∏û.‡∏®.) ‡πÄ‡∏õ‡πá‡∏ô ISO (YYYY-MM-DD)
function thaiToIso(thaiDate) {
  if (!thaiDate || !thaiDate.includes("/")) return "";
  const parts = thaiDate.split("/");
  if (parts.length !== 3) return "";
  const day = parts[0].padStart(2, "0");
  const month = parts[1].padStart(2, "0");
  const year = parseInt(parts[2]) - 543;
  return `${year}-${month}-${day}`;
}

// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ö‡∏ô‡∏ä‡πà‡∏≠‡∏á input
function updateThaiDateDisplay(fieldId, isoDate) {
  if (!isoDate) return;
  const thaiDate = isoToThai(isoDate);
  const field = document.getElementById(fieldId);
  field.setAttribute("data-thai-date", thaiDate);
}

// ‚úÖ ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á input (‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏ó‡∏¢)
document.getElementById("jobNumberInput").value = jobNumber;
document.getElementById("startDateInput").value = formatDateThai(start);
document.getElementById("endDateInput").value = formatDateThai(end);

// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Realtime Database ‡∏ï‡∏≤‡∏° jobNumber
async function loadData(jobNumber) {
  if (!jobNumber) return;

  const dataRef = ref(db, `report2/${jobNumber}`);
  const snap = await get(dataRef);

  if (snap.exists()) {
    const d = snap.val();

    // ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏•‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
    time1.value = d.time1 || "";
    
    // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô input type="date" (ISO format)
    if (d.date2) {
      if (d.date2.includes("-") && d.date2.length === 10) {
        document.getElementById("date2").value = d.date2;
        updateThaiDateDisplay("date2", d.date2);
      } else if (d.date2.includes("/")) {
        const iso = thaiToIso(d.date2);
        document.getElementById("date2").value = iso;
        updateThaiDateDisplay("date2", iso);
      }
    }
    
    time2.value = d.time2 || "";
    
    if (d.date3) {
      if (d.date3.includes("-") && d.date3.length === 10) {
        document.getElementById("date3").value = d.date3;
        updateThaiDateDisplay("date3", d.date3);
      } else if (d.date3.includes("/")) {
        const iso = thaiToIso(d.date3);
        document.getElementById("date3").value = iso;
        updateThaiDateDisplay("date3", iso);
      }
    }
    
    time3.value = d.time3 || "";
    time4.value = d.time4 || "";

    // checkbox
    for (const key of [
      "car_company","car_sales","bus","plane",
      "sales_no","sales_yes","sales_together","sales_separate",
      "company_have","company_not_have",
      "schedule_have","schedule_not_have",
      "map_have","map_not_have",
      "plug_have","plug_not_have",
      "air_have","air_not_have",
      "MPUA","MPUB","MPUC","MPUD",
      "MC_01","MC_02","MC_03",
      "move_all_top","move_all_bottom","move_partial"
    ]) {
      if (document.getElementById(key)) {
        document.getElementById(key).checked = !!d[key];
      }
    }

    // text fields
    PLC1.value = d.PLC1 || "";
    ver.value = d.ver || "";
    BOT.value = d.BOT || "";
    ver2.value = d.ver2 || "";
    tableSize.value = d.tableSize || "";
    otherEquip.value = d.otherEquip || "";
    roomInfo.value = d.roomInfo || "";

    // carry items
    if (d.carry && d.carry.length) {
      carry1.value = d.carry[0]?.item || "";
      carryQty1.value = d.carry[0]?.qty || "";
      carry2.value = d.carry[1]?.item || "";
      carryQty2.value = d.carry[1]?.qty || "";
      carry3.value = d.carry[2]?.item || "";
      carryQty3.value = d.carry[2]?.qty || "";
    }

    statusMsg.textContent = "üìÑ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
    statusMsg.style.color = "blue";
  }
}

// ‚úÖ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ jobNumber ‚Üí ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
if (jobNumber) loadData(jobNumber);

// ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏ó‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà
document.getElementById("date2").addEventListener("change", function() {
  updateThaiDateDisplay("date2", this.value);
});

document.getElementById("date3").addEventListener("change", function() {
  updateThaiDateDisplay("date3", this.value);
});

// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
window.saveFile = async function() {
  const jobNum = document.getElementById("jobNumberInput").value.trim();
  if (!jobNum) { alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å"); return; }

  const data = {
    jobNumber: jobNum,
    date1: thaiToIso(startDateInput.value) || startDateInput.value, // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô ISO (‡∏Ñ.‡∏®.)
    time1: time1.value,
    date2: document.getElementById("date2").value, // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô ISO format (YYYY-MM-DD)
    time2: time2.value,
    date3: document.getElementById("date3").value, // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô ISO format (YYYY-MM-DD)
    time3: time3.value,
    date4: thaiToIso(endDateInput.value) || endDateInput.value, // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô ISO (‡∏Ñ.‡∏®.)
    time4: time4.value,

    car_company: car_company.checked,
    car_sales: car_sales.checked,
    bus: bus.checked,
    plane: plane.checked,

    sales_no: sales_no.checked,
    sales_yes: sales_yes.checked,
    sales_together: sales_together.checked,
    sales_separate: sales_separate.checked,

    company_have: company_have.checked,
    company_not_have: company_not_have.checked,
    schedule_have: schedule_have.checked,
    schedule_not_have: schedule_not_have.checked,
    map_have: map_have.checked,
    map_not_have: map_not_have.checked,
    plug_have: plug_have.checked,
    plug_not_have: plug_not_have.checked,
    air_have: air_have.checked,
    air_not_have: air_not_have.checked,

    MPUA: MPUA.checked, 
    MPUB: MPUB.checked, 
    MPUC: MPUC.checked, 
    MPUD: MPUD.checked,
    MC_01: MC_01.checked, 
    MC_02: MC_02.checked, 
    MC_03: MC_03.checked,

    PLC1: PLC1.value, 
    ver: ver.value,
    BOT: BOT.value, 
    ver2: ver2.value,
    tableSize: tableSize.value, 
    otherEquip: otherEquip.value,

    move_all_top: move_all_top.checked,
    move_all_bottom: move_all_bottom.checked,
    move_partial: move_partial.checked,

    carry: [
      { item: carry1.value, qty: carryQty1.value },
      { item: carry2.value, qty: carryQty2.value },
      { item: carry3.value, qty: carryQty3.value }
    ],

    roomInfo: roomInfo.value,
    timestamp: new Date().toISOString()
  };

  try {
    await set(ref(db, `Report/report2/${jobNum}`), data);
    statusMsg.textContent = "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!";
    statusMsg.style.color = "green";
    setTimeout(() => {
      window.location.href = "notchoose.html";
    }, 1000);
  } catch (err) {
    statusMsg.textContent = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message;
    statusMsg.style.color = "red";
  }
};
</script>

</body>
</html>